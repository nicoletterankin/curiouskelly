{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Reinmaker Player State",
  "description": "Client-side state snapshot persisted via Hive for the Reinmaker game.",
  "type": "object",
  "required": ["version", "xp", "lenses", "stones", "quests", "settings"],
  "additionalProperties": false,
  "properties": {
    "version": {
      "type": "string",
      "pattern": "^rmk\\.v[0-9]+$"
    },
    "ageBucket": {
      "type": "string",
      "enum": ["2-5", "6-12", "13-17", "18-35", "36-60", "61-102"]
    },
    "xp": {
      "type": "integer",
      "minimum": 0
    },
    "lenses": {
      "type": "object",
      "patternProperties": {
        "^lens\\.(ui_composition|system_design|mech_proto|alg_reasoning|dialogue_empathy|meta_reflection|challenge_mastery)$": {
          "type": "object",
          "required": ["level"],
          "additionalProperties": false,
          "properties": {
            "level": {
              "type": "integer",
              "minimum": 0,
              "maximum": 9
            },
            "unlockedAt": {
              "type": "string",
              "format": "date-time"
            }
          }
        }
      },
      "additionalProperties": false
    },
    "stones": {
      "type": "object",
      "properties": {
        "light": { "$ref": "#/definitions/stoneCollection" },
        "stone": { "$ref": "#/definitions/stoneCollection" },
        "metal": { "$ref": "#/definitions/stoneCollection" },
        "code": { "$ref": "#/definitions/stoneCollection" },
        "air": { "$ref": "#/definitions/stoneCollection" },
        "water": { "$ref": "#/definitions/stoneCollection" },
        "fire": { "$ref": "#/definitions/stoneCollection" }
      },
      "additionalProperties": false
    },
    "featuredTribe": {
      "type": "string",
      "enum": ["Light", "Stone", "Metal", "Code", "Air", "Water", "Fire"]
    },
    "lastFeaturedRotation": {
      "type": "string",
      "format": "date-time"
    },
    "quests": {
      "type": "object",
      "patternProperties": {
        "^q\\.(light|stone|metal|code|air|water|fire)\\.[0-9]{3}$": {
          "type": "object",
          "required": ["status", "attempts"],
          "additionalProperties": false,
          "properties": {
            "status": {
              "type": "string",
              "enum": ["locked", "available", "completed"]
            },
            "attempts": {
              "type": "integer",
              "minimum": 0
            },
            "bestScore": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "lastPlayedAt": {
              "type": "string",
              "format": "date-time"
            }
          }
        }
      },
      "additionalProperties": false
    },
    "unlockedCosmetics": {
      "type": "array",
      "items": {
        "type": "string",
        "pattern": "^(badge|frame)\\.[a-z_]+\\.[a-z_]+$"
      },
      "uniqueItems": true
    },
    "activeCosmetic": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "badgeId": {
          "type": "string",
        "pattern": "^badge\\.[a-z_]+\\.[a-z_]+$"
        },
        "frameId": {
          "type": "string",
        "pattern": "^frame\\.[a-z_]+\\.[a-z_]+$"
        }
      }
    },
    "settings": {
      "type": "object",
      "required": ["captionsEnabled", "iconOnlyMode", "highContrast"],
      "additionalProperties": false,
      "properties": {
        "captionsEnabled": { "type": "boolean" },
        "iconOnlyMode": { "type": "boolean" },
        "highContrast": { "type": "boolean" },
        "textScale": {
          "type": "number",
          "minimum": 0.8,
          "maximum": 1.6
        }
      }
    }
  },
  "definitions": {
    "stoneCollection": {
      "type": "array",
      "items": {
        "type": "string",
        "pattern": "^(light|stone|metal|code|air|water|fire)\\.(spark|craft|mastery)$"
      },
      "uniqueItems": true,
      "maxItems": 3
    }
  }
}


